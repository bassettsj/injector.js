/*! injector-js - v0.2.1 - 2015-07-28
* Copyright (c) 2015 Bigger Boat; 
*/
(function(t){var n="object"==typeof self&&self.self==self&&self||"object"==typeof global&&global.global==global&&global;"function"==typeof define&&define.amd?define([],function(){n.injector=t(n)}):"undefined"!=typeof exports?module.exports=t(n):n.injector=t(n)})(function(t){var n={};return n.InjectionMapping=function(t,n,e){this._type=t,this._name=n,this._id=e,this._value=null,this._toType=null,this._isValid=function(){return null!=this._value||null!=this._toType},this._validateBeforeCreation=function(){if(this._isValid())throw Error("Could not create mapping for "+this._id+" because it already has been defined");return!0}},n.InjectionMapping.prototype={toValue:function(t){this._validateBeforeCreation()&&(this._value=t)},toType:function(t){this._validateBeforeCreation()&&(this._toType=t)},toSingleton:function(t){this.toValue(new t)},getValue:function(){if(!this._isValid())throw Error("Could not get value for "+this._id+" because the mapping is invalid");return null!=this._value?this._value:null!=this._toType?new this._toType:void 0}},n.Injector=function(t){this._mappings={},this._parentInjector=null,this._createMapping=function(t,e,i){if(this._hasOwnMapping(t,e))throw Error("Already has mapping for "+t);var o=new n.InjectionMapping(t,e,i);return this._mappings[i]=o,o},this._getMappingID=function(t,n){return n=void 0==n?"":n,t+"|"+n},this._hasOwnMapping=function(t,n){var e=this._getMappingID(t,n);return void 0!==this._mappings[e]},this._postConstruct=function(t){var n,e,i,o=void 0!==t.postConstructs?t.postConstructs instanceof Array?t.postConstructs:[]:[];for(n in o)e=o[n],i=void 0===t[e]?null:t[e],"function"==typeof i&&i.apply(t)},this.map("injector").toValue(this),this._parentInjector=t||null},n.Injector.prototype={map:function(t,n){var e=this._getMappingID(t,n);return this._mappings[e]||this._createMapping(t,n,e)},unmap:function(t,n){if(!this.hasMapping(t,n)){var e=void 0==n?"":" by name "+n;throw Error('Cannot unmap "'+t+e+'" because no mapping has been found')}var i=this._getMappingID(t,n);delete this._mappings[i]},hasMapping:function(t,n){return this._hasOwnMapping(t,n)||null!==this._parentInjector&&this._parentInjector.hasMapping(t,n)},hasDirectMapping:function(t,n){return this._hasOwnMapping(t,n)},getInstance:function(t,n){if(this.hasMapping(t,n))return this.getMapping(t,n).getValue();var e=void 0==n?"":" by name "+n;throw Error('Cannot return instance "'+t+e+'" because no mapping has been found')},getMapping:function(t,n){if(this.hasMapping(t,n)){var e=this._getMappingID(t,n);return void 0!==this._mappings[e]?this._mappings[e]:this.getParentInjector().getMapping(t,n)}var i=void 0==n?"":" by name "+n;throw Error('Mapping "'+t+i+'" was not found')},injectInto:function(t){var e,i;for(e in t)if(i=n.utils.stringToObject(e,t[e]),null!=i){if(!this.hasMapping(i.type,i.name))throw Error("Cannot inject "+i.type+" into "+t+" due to a missing rule");t[e]=this.getInstance(i.type,i.name)}this._postConstruct(t)},teardown:function(){this._mappings={},this.map("injector").toValue(this)},getParentInjector:function(){return this._parentInjector},setParentInjector:function(t){if(null!=t&&!(t instanceof n.Injector))throw Error("Cannot set the parentInjector because it is not an injector");this._parentInjector=t},createChildInjector:function(){return new n.Injector(this)}},n.utils={},n.utils.stringToObject=function(t,n){if("string"!=typeof n)return null;var e,i,o={name:"",type:t},a=RegExp("^inject"),r=RegExp(/[\w:\-]?name[\s]*?=[\s]*?("[^"]+"|'[^']+'|\w+)/),s=RegExp(":[^:]+$");return"inject"==n?o:n.match(a)?(e=r.exec(n),i=s.exec(n),o.name=null!=e&&2==e.length?e[1].replace(/"/gm,""):"",o.type=null!=i&&1==i.length?i[0].replace(":",""):t,o):null},t.injector=n,n});